# aruco_trigger_capture_yolo.py 파일 길이 분석

## 현재 상태
- **총 라인 수**: 502줄
- **클래스**: ArucoTrigger (약 470줄)

## 왜 아직도 긴가?

### 1. 아직 분리하지 않은 부분들

#### A. 회전/주행 제어 로직 (약 110줄)
- `_rotate_in_place()` - 30줄
- `_drive_distance()` - 30줄  
- `_drive_circle()` - 50줄

**문제점**: 여전히 ROS 직접 사용 (`rospy.Publisher`, `Twist` 직접 사용)
**해결책**: MotorInterface 사용하도록 변경

#### B. 규칙 정의 (약 30줄)
- `self.rules` 딕셔너리 - 클래스 내부에 하드코딩
**해결책**: 설정 파일로 분리 (`src/configs/aruco_rules.py`)

#### C. 복잡한 상태 관리 로직 (약 70줄)
- `observe_and_maybe_trigger()` - 연속 프레임 체크, 쿨다운 체크, 규칙 매칭 등
**해결책**: 일부를 유틸 함수로 분리 가능

#### D. 초기화 코드 (약 100줄)
- 많은 설정 변수들 (쿨다운, 디렉토리, 필터 기준 등)
**해결책**: 설정 클래스로 분리 가능

---

## 추가 분리 가능한 부분

### 우선순위 1: 회전/주행 제어를 MotorInterface로 변경
**현재**:
```python
def _rotate_in_place(self, ...):
    msg = Twist()
    self.drive_pub.publish(msg)  # ROS 직접 사용
```

**개선 후**:
```python
def _rotate_in_place(self, ...):
    duration = compute_turn_duration(...)
    # MotorInterface 사용
    self.motor.set_linear_angular(0, angular_speed)
    rospy.sleep(duration)
    self.motor.stop()
```

**효과**: 약 110줄 → 30줄로 감소

### 우선순위 2: 규칙 정의를 설정 파일로 분리
**현재**: 클래스 내부에 하드코딩 (30줄)
**개선 후**: `src/configs/aruco_rules.py`로 분리

**효과**: 약 30줄 감소

### 우선순위 3: observe_and_maybe_trigger 로직 분리
- 연속 프레임 체크 → 유틸 함수
- 쿨다운 체크 → 유틸 함수
- 규칙 매칭 → 유틸 함수

**효과**: 약 70줄 → 30줄로 감소

---

## 예상 결과

**현재**: 502줄
**개선 후**: 약 250-300줄 (40-50% 감소)

---

## 결론

아직도 긴 이유:
1. ✅ 유틸 함수 분리 완료 (마커 검출, 이미지 저장, 포트홀 감지, 시간 계산)
2. ❌ 회전/주행 제어는 여전히 ROS 직접 사용 (MotorInterface 미사용)
3. ❌ 규칙 정의가 클래스 내부에 하드코딩
4. ❌ 복잡한 상태 관리 로직이 메서드 내부에 집중

**추가 작업 필요**: 회전/주행 제어를 MotorInterface로 변경하면 크게 줄어듭니다.

